const MODAL_VIEWPORT_RATIO=.9;document.addEventListener("DOMContentLoaded",()=>{document.body.classList.add("loaded");const e=document.getElementById("current-year");e&&(e.textContent=(new Date).getFullYear());const t=document.getElementById("logo-link")||document.querySelector(".logo");t&&t.addEventListener("click",e=>{e.preventDefault(),window.scrollTo({top:0,behavior:"smooth"}),history.pushState(null,null,"/")});const n=document.querySelector(".site-header");if(n){const e=()=>{n.classList.toggle("scrolled",window.scrollY>0)};window.addEventListener("scroll",e),e()}initVideoPlaceholders(),document.querySelectorAll(".teaser-toggle").forEach(e=>{e.addEventListener("click",()=>{const t=e.closest("section, .testimonial, .bio-card").querySelector(".teaser-full"),n="true"===e.getAttribute("aria-expanded");t.classList.toggle("hidden"),e.textContent=n?"Read More":"Show Less",e.setAttribute("aria-expanded",String(!n))})});const o=document.getElementById("contact-form"),r=document.getElementById("success-msg");o&&o.addEventListener("submit",async e=>{e.preventDefault();const t=Object.fromEntries(new FormData(o).entries());try{const e=await fetch(o.action,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),n=await e.json();e.ok&&n&&n.success?(o.reset(),r&&(r.hidden=!1)):alert("Sorry, there was a problem sending your message. Please try again later.")}catch(e){alert("Sorry, there was a problem sending your message. Please try again later.")}})});const navToggle=document.querySelector(".nav-toggle"),navList=document.querySelector(".nav-list"),navLinks=document.querySelectorAll(".nav-list a");if(navToggle&&navList&&(navToggle.addEventListener("click",()=>{const e=navList.classList.toggle("active");navToggle.classList.toggle("active",e),document.body.classList.toggle("nav-open",e),navToggle.textContent=e?"✖️":"☰",navToggle.setAttribute("aria-expanded",e)}),navToggle.setAttribute("aria-expanded","false"),navLinks.forEach(e=>{e.addEventListener("click",()=>{navList.classList.contains("active")&&(navList.classList.remove("active"),navToggle.classList.remove("active"),document.body.classList.remove("nav-open"),navToggle.textContent="☰",navToggle.setAttribute("aria-expanded",!1))})})),navLinks.length>0){const e=Array.from(navLinks).map(e=>document.querySelector(e.hash)).filter(Boolean),t=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){const t=e.target.id;navLinks.forEach(e=>{e.classList.toggle("active",e.hash===`#${t}`)})}})},{threshold:.25});e.forEach(e=>t.observe(e))}function initVideoPlaceholders(){document.querySelectorAll(".video-wrapper").forEach(e=>{const t=e.querySelector("img"),n=e.querySelector(".play-button");if(!t||!n)return;const o=e.dataset.title;if(o){const t=document.createElement("div");t.className="video-title",t.textContent=o,e.appendChild(t)}const r=()=>{const n=t.naturalWidth/t.naturalHeight;n&&e.style.setProperty("--ratio",n)};t.complete?r():t.addEventListener("load",r),n.addEventListener("click",t=>{t.preventDefault(),openModal(e)}),e.addEventListener("mouseenter",()=>showPreview(e)),e.addEventListener("mouseleave",()=>hidePreview(e))})}function openModal(e){hidePreview(e);const t=document.getElementById("video-modal"),n=t.querySelector(".modal-video-container"),o=`${e.dataset.src}?autoplay=1`,r=parseFloat(e.style.getPropertyValue("--ratio"))||16/9;let a=.9*window.innerWidth,i=a/r;i>.9*window.innerHeight&&(i=.9*window.innerHeight,a=i*r),n.style.width=`${a}px`,n.style.height=`${i}px`,n.style.setProperty("--modal-ratio",r),n.innerHTML=`<iframe src="${o}" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen tabindex="0" title="Video player"></iframe>`,t.hidden=!1,document.body.style.overflow="hidden";const s=n.querySelector("iframe");s&&s.focus();const l=()=>{let e=.9*window.innerWidth,t=e/r;t>.9*window.innerHeight&&(t=.9*window.innerHeight,e=t*r),n.style.width=`${e}px`,n.style.height=`${t}px`};window.addEventListener("resize",l),n._resizeHandler=l}function closeModal(){const e=document.getElementById("video-modal"),t=e.querySelector(".modal-video-container");e.hidden=!0,t.innerHTML="",t.style.width="",t.style.height="",t._resizeHandler&&(window.removeEventListener("resize",t._resizeHandler),delete t._resizeHandler),document.body.style.overflow=""}function getPreviewSrc(e){if(!e)return"";if(e.includes("youtube")){const t=e.match(/embed\/(.*?)(\?|$)/),n=t?t[1]:"";return n?`https://www.youtube.com/embed/${n}?autoplay=1&mute=1&controls=0&loop=1&start=0&end=2&playlist=${n}`:""}return e.includes("vimeo")?`${e}?autoplay=1&muted=1&loop=1#t=0,2`:""}function showPreview(e){const t=getPreviewSrc(e.dataset.src);if(!t)return;let n=e.querySelector(".preview-iframe");n||(n=document.createElement("iframe"),n.className="preview-iframe",n.setAttribute("aria-hidden","true"),n.setAttribute("tabindex","-1"),n.allow="autoplay; muted",e.appendChild(n)),n.src=t}function hidePreview(e){const t=e.querySelector(".preview-iframe");t&&t.remove()}document.querySelector("#video-modal .modal-close").addEventListener("click",closeModal),document.getElementById("video-modal").addEventListener("click",function(e){e.target===this&&closeModal()}),document.querySelector("#video-modal .modal-content").addEventListener("click",e=>e.stopPropagation()),document.addEventListener("keydown",e=>{"Escape"===e.key&&closeModal()});